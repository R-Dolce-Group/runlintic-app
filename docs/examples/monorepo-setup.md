# ðŸ“¦ Monorepo Setup Guide

Complete guide for integrating Runlintic App with Next.js Turbo monorepos.

## Overview

This guide shows how to integrate Runlintic App into a Next.js Turbo monorepo for optimal development workflow and release management.

## Prerequisites

- Node.js â‰¥ 22.16.0
- Existing Next.js Turbo monorepo or willingness to create one
- Git repository initialized
- GitHub token (for releases)

## Quick Setup

### 1. Install in Monorepo Root

```bash
cd your-monorepo
npm install -D @rdolcegroup/runlintic-app
```

### 2. Initialize Configuration

```bash
npx runlintic init
```

### 3. Add Package.json Scripts

```json
{
  "scripts": {
    "health-check": "runlintic health-check",
    "lint": "runlintic lint",
    "lint:fix": "runlintic lint:fix",
    "commit": "runlintic commit",
    "release:dry": "runlintic release:dry"
  }
}
```

### 4. Run Health Check

```bash
npm run health-check
```

## Monorepo Structure Integration

### Typical Monorepo Layout

```text
your-monorepo/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web/              # Next.js frontend
â”‚   â”œâ”€â”€ api/              # Backend API
â”‚   â””â”€â”€ docs/             # Documentation site
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ ui/               # Shared components
â”‚   â”œâ”€â”€ config/           # Shared configs
â”‚   â””â”€â”€ utils/            # Shared utilities
â”œâ”€â”€ package.json          # Root package.json (install here)
â”œâ”€â”€ turbo.json           # Turbo configuration
â”œâ”€â”€ eslint.config.js     # Generated by runlintic
â”œâ”€â”€ tsconfig.json        # Generated by runlintic
â””â”€â”€ .release-it.json     # Generated by runlintic
```

### Where to Run Commands

**Root Level (Recommended):**

```bash
# Run from monorepo root for full project
npm run health-check     # Checks entire monorepo
npm run lint            # Lints all workspaces
npm run commit          # Commits for entire project
npm run release:dry     # Releases entire monorepo
```

**Individual Workspaces:**

```bash
# For workspace-specific tasks
cd apps/web
npx runlintic lint      # Lint only web app
npx runlintic typecheck # Check only web app types
```

## Step-by-Step Setup Guide

### Phase 1: Environment Preparation

**Create Test Environment (Optional):**

```bash
# Create isolated test directory
mkdir ~/runlintic-testing
cd ~/runlintic-testing

# Create realistic Next.js Turbo monorepo
npx create-turbo@latest test-monorepo --package-manager npm
cd test-monorepo
```

### Phase 2: Installation

**Install Runlintic:**

```bash
# Install as dev dependency (recommended for teams)
npm install -D @rdolcegroup/runlintic-app

# Verify installation
npm list @rdolcegroup/runlintic-app
npx runlintic --version
```

**Verify CLI Access:**

```bash
npx runlintic help
npx runlintic --version
```

### Phase 3: Configuration

**Initialize Project:**

```bash
# Run from monorepo root
npx runlintic init

# Verify created files
ls -la | grep -E "(eslint|tsconfig|release-it|commitlint)"
```

**Files Created:**

- âœ… `eslint.config.js` - Zero-warning ESLint setup
- âœ… `tsconfig.json` - Strict TypeScript config
- âœ… `.release-it.json` - Release automation
- âœ… `commitlint.config.cjs` - Conventional commits
- âœ… `RUNLINTIC-*.md` - Documentation guides

### Phase 4: Team Integration

**Add to Package.json:**

```json
{
  "scripts": {
    "dev": "turbo run dev",
    "build": "turbo run build",
    "health-check": "runlintic health-check",
    "lint": "runlintic lint",
    "lint:fix": "runlintic lint:fix",
    "commit": "runlintic commit",
    "release:dry": "runlintic release:dry",
    "release:patch": "runlintic release:patch"
  }
}
```

**Team Usage:**

```bash
# Team members can now use
npm run health-check
npm run lint
npm run commit
```

## Daily Workflow

### Development Cycle

```bash
# 1. Make changes across monorepo
git add .

# 2. Generate intelligent commit
npm run commit

# 3. Quality checks (40% faster with parallel execution)
npm run health-check

# 4. Auto-fix any issues
npm run lint:fix
```

### Release Workflow

```bash
# 1. Setup GitHub token (one-time)
export GH_TOKEN="your_github_token_here"

# 2. Preview release
npm run release:dry

# 3. Create release
npm run release:patch  # or minor/major
```

## Testing Your Setup

### Installation Verification

- [ ] Local installation works
- [ ] CLI binary accessible via npx
- [ ] Package version matches expected
- [ ] npm scripts integration works

### Core Commands Testing

```bash
# Test each command
npx runlintic help
npx runlintic health-check
npx runlintic check-all
npx runlintic lint
npx runlintic typecheck
npx runlintic format
```

### Monorepo-Specific Testing

```bash
# Test in different contexts
cd apps/web && npx runlintic health-check
cd packages/ui && npx runlintic lint
cd ../.. # back to root

# Test workspace integration
npm run health-check  # Should work from root
```

### Release Testing

```bash
# Test token validation
npx runlintic release:dry  # Should show token requirement

# Set token and test
export GH_TOKEN="your_token"
npx runlintic release:dry  # Should show preview
```

## Performance Optimization

### Turbo Integration

```json
// turbo.json
{
  "pipeline": {
    "health-check": {
      "cache": false,
      "dependsOn": ["^build"]
    },
    "lint": {
      "cache": true,
      "outputs": []
    },
    "typecheck": {
      "cache": true,
      "outputs": []
    }
  }
}
```

### Parallel Execution Benefits

```bash
# Before: Sequential execution
npm run lint && npm run typecheck && npm run deps:check
# Time: ~8-12s in large monorepos

# After: Parallel execution
npm run health-check
# Time: ~5-7s (40% improvement)
```

## Troubleshooting Monorepo Issues

### Common Issues

**Workspace Dependencies:**

```bash
# If dependencies seem missing
npm install  # Install from root
# Or
npm ci      # Clean install
```

**TypeScript Path Issues:**

```json
// tsconfig.json - Update paths if needed
{
  "extends": "./node_modules/@rdolcegroup/runlintic-app/lib/configs/base.json",
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"],
      "@ui/*": ["./packages/ui/*"]
    }
  }
}
```

**ESLint Workspace Resolution:**

```javascript
// eslint.config.js - Add workspace awareness
import baseConfig from '@rdolcegroup/runlintic-app/lib/configs/base.js';

export default [
  ...baseConfig,
  {
    // Workspace-specific rules
    files: ['apps/**/*.js', 'packages/**/*.js'],
    rules: {
      // Custom rules for workspace
    },
  },
];
```

### Performance Issues

```bash
# If commands are slow in large monorepos
export NODE_OPTIONS="--max-old-space-size=4096"

# Or increase memory per command
node --max-old-space-size=4096 ./node_modules/.bin/runlintic health-check
```

## Advanced Configuration

### Custom Workspace Scripts

```json
// apps/web/package.json
{
  "scripts": {
    "dev": "next dev",
    "lint": "runlintic lint .",
    "typecheck": "runlintic typecheck"
  }
}
```

### CI/CD Integration

```yaml
# .github/workflows/ci.yml
name: CI
on: [push, pull_request]

jobs:
  quality:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '22'
      - run: npm ci
      - run: npm run health-check
      - run: npm run build
```

## Success Criteria

### Must Pass:

- âœ… Package installs without errors
- âœ… All CLI commands execute successfully
- âœ… Configuration files created correctly
- âœ… Works from monorepo root and individual workspaces

### Should Pass:

- âœ… Performance improvements are noticeable (40% faster)
- âœ… Team can use npm scripts consistently
- âœ… Release workflow works end-to-end
- âœ… Monorepo structure is respected

## Why Local Installation for Monorepos

**Benefits:**

- âœ… **Version consistency** - All team members use same version
- âœ… **Workspace integration** - Works with npm workspaces/Turbo
- âœ… **CI/CD friendly** - Installs automatically in pipelines
- âœ… **No global dependencies** - New machines work immediately
- âœ… **Team scripts** - Consistent commands across team

**Comparison:**

```bash
# Team-friendly (recommended)
npm run health-check

# Individual setup (not recommended)
runlintic health-check  # Requires global install
```

## Next Steps

1. **Setup complete?** Try the [Daily Workflow](../quick-start.md#daily-workflow)
2. **Need customization?** See [Configuration Guide](../configuration.md)
3. **Release issues?** Check [Release Workflow](../release-workflow.md)
4. **Problems?** See [Troubleshooting](../troubleshooting.md)

Your Next.js Turbo monorepo is now ready for automated code quality and releases! ðŸš€
